# Comparaison de moyennes

## Préambule

### Nomenclature

Dans ce chapitre, nous supposons que:

-   La **réponse** $Y$ est une variable quantitative continue qui suit une distribution normale;

-   L'hypothèse de test porte sur l'existence de différence(s) de la moyenne de $Y$ entre plusieurs groupes;

-   Les groupes sont des **niveaux** du **facteur/critère** $X$;

-   $X$ est une variable discrète, souvent qualitative nominale;

-   $X$ peut être **fixe** ou **aléatoire**:

    -   fixe: on ne s'intéresse qu'aux niveaux étudiés, choisis spécifiquement (p. ex. mâle *vs* femelle);

    -   aléatoire: on s'intéresse à tous les niveaux possibles, parmi lesquels on en a étudié certains choisis aléatoirement (p. ex. Espagne, Finlande et Pologne pour représenter l'UE).

### Techniques de comparaison de moyennes

Dans le cas ou le jeu de données contient 2 niveaux pour $X$ (c.à.d. 2 groupes) alors on effectue un test de $t$. S'il y a plus de 2 niveaux pour $X$ alors une analyse de variance à un critère de classification (ANOVA 1) est choisi. S'il y a plus d'un critère de classification pour $X$ alors on aura un ANOVA2, ANOVA3, ...

## Comparaison de 2 moyennes

On distingue 2 cas pour les expériences où une variable continue $Y$ est mesurée sur les individus appartenant à 2 groupes (A et B):

-   Soit une mesure du groupe A est associé avec 1 et 1 seule mesure du groupe B (et inversement): les données sont dites **"pairées"**;

-   Soit les mesures du groupe A ne sont pas associées aux mesures du groupe B: les données sont dites **"indépendantes"**.

::: callout-note
## Lire les valeurs critiques (fractiles) de la loi de t avec R

Pour trouver la valeur critique T dans R, vous pouvez utiliser la fonction qt(), qui utilise la syntaxe suivante :

```{r, eval=FALSE}
qt(p, df, lower.tail=TRUE)
```

où :

-   **p**: le niveau de signification à utiliser;

-   **df**: Les degrés de liberté;

-   **lower.tail**: Si TRUE, la probabilité à gauche de **p** dans la distribution *t* est renvoyée. Si FALSE, la probabilité à droite est renvoyée. La valeur par défaut est TRUE.

**Test unilatéral à gauche**

Supposons que nous voulions trouver la valeur critique de $t$ pour un test unilatéral gauche avec un niveau de signification de 0,05 et un degrés de liberté = 18.

```{r}
qt(p = 0.05, df = 18, lower.tail = TRUE)
```

La valeur critique $t$ est de -1,734. Ainsi, si la statistique du test est inférieure à cette valeur, les résultats du test sont statistiquement significatifs.

**Test unilatéral à droite**

Supposons que nous voulions trouver la valeur critique de $t$ pour un test unilatéral à droite avec un niveau de signification de 0,05 et un degrés de liberté = 18.

```{r}
qt(p = 0.05, df = 18, lower.tail = FALSE)
```

La valeur critique $t$ est de 1,734. Ainsi, si la statistique du test est supérieur à cette valeur, les résultats du test sont statistiquement significatifs.

**Test bilatéral**

Supposons que nous voulions trouver la valeur critique de $t$ pour un test bilatéral avec un niveau de signification de 0,05 et un degrés de liberté = 18.

```{r}
qt(p = 0.05/2, df = 18, lower.tail = FALSE)
```

Chaque fois que vous effectuez un test bilatéral, il y a deux valeurs critiques. Dans le cas présent, les valeurs critiques de T sont 2,1 et -2,1.

Par conséquent, si la statistique du test est inférieure à -2,1 ou supérieure à 2,1, les résultats du test sont statistiquement significatifs.
:::

### Test de $t$ pairé

Par exemple, on mesure le temps mis par des sprinteurs pour couvrir le 100m lors de 2 jours de course consécutifs, pour vérifier l'existence d'un effet d'adaptation à un environnement non familier. On a alors les hypothèses suivantes:

-   $H_0$: il n'y a pas de différence entre les 2 jours;

-   $H_A$: il y a une différence entre les 2 jours.

Pour un test de $t$ pairé on a $t_{obs} = \frac{\bar{Y_D} - \mu_D}{SEM} = \frac{\bar{Y_D} - \mu_D}{\frac{S_D}{\sqrt{n - 1}}} \sim St(n-1)$.

En partant de l'exemple précédent dont les données onst présentées ici:

| Numéro | Temps de course (Jour 1) | Temps de course (Jour 2) | Différence  |
|--------|--------------------------|--------------------------|-------------|
| 1      | 13,5                     | 13,6                     |  +0,1       |
| 2      | 14,6                     | 14,6                     | 0,0         |
| 3      | 12,7                     | 12,6                     | -0,1        |
| 4      | 15,5                     | 15,7                     | +0,2        |
| 5      | 11,1                     | 11,1                     | 0,0         |
| 6      | 16,4                     | 16,6                     | +0,2        |
| 7      | 13,2                     | 13,2                     | 0,0         |
| 8      | 19,3                     | 19,5                     | +0,2        |
| 9      | 16,7                     | 16,8                     | +0,1        |
| 10     | 18,4                     | 18,7                     | +0,3        |

Pour rappel, le test de $t$ n'est rien d'autre qu'un test d'hypothèse sur une moyenne:

-   $H_0$ :$\mu = \mu_0$ , en d'autre termes la moyenne de la différence est égale à 0;

-   $H_A$: $\mu \neq \mu_0$, en d'autres termes, la moyenne de la différence est différente de 0.

A partir des données ci-dessus présentées on a:

-   Dégré de libertés (ddl) = $n-1$ = 10 - 1 = 9;

-   $\bar{X} = 0,100$, $s = 0,1247$, $n = 10$;

-   $SEM = \frac{S_D}{\sqrt{n - 1}}$ = 0,0394.

Pour un dégré de liberté de 9 on a $t_9 = \frac{0,10 - 0}{0,03944} = 2,5355$.

En utilisant la table ou R (voir ci-dessous) la valeur critique de $t_9$ pour $\alpha = 0,05$ est de $2,262$ ($t_{obs} = 2,5355 > t_{lu} = 2,263$).

```{r}
qt(p=0.05/2, df=9, lower.tail=FALSE)
```

Par conséquent, la valeur de $t$ se situe en dehors de l'intervalle dans lequel on s'attendrait à ce que $95 \%$ des statistiques $t$ générées par des échantillons de $n = 9$ à partir d'une population où $\mu = 0$. Il a donc été conclu que la moyenne de la population des différences de temps de course était significativement différente ($P < 0,05$) d'une moyenne attendue de zéro.

### Test de $t$ indépendant

Un écologiste a échantillonné la longueur de la coquille de 15 palourdes d'eau douce dans chacun de deux lacs afin de déterminer si ces échantillons étaient susceptibles de provenir de populations ayant la même longueur moyenne de coquille.

| Lac A | Lac B |
|-------|-------|
| 25    | 45    |
| 40    | 37    |
| 34    | 36    |
| 37    | 38    |
| 38    | 49    |
| 35    | 47    |
| 29    | 32    |
| 32    | 41    |
| 35    | 38    |
| 44    | 45    |
| 27    | 33    |
| 33    | 39    |
| 37    | 46    |
| 38    | 47    |
| 36    | 40    |

Pour cette étude on a les hypothèses suivantes:

-   $H_0: \mu_A = \mu_B$: il n'y a pas de différence de taille moyenne entre les 2 lacs;

-   $H_1: \mu_A \neq \mu_B$: il y a une différence de taille moyenne entre les 2 lacs.

Pour tester les hypothèses, il faut tenir compte de la taille des deux populations desquelles dépend le $t_{obs}$ :

-   Si $n_A = n_B$: $t_{obs} = \frac{(\bar{Y_A} - \bar{Y_B}) - (\mu_A - \mu_B)}{\sqrt{\frac{S^2_A}{n_A} + \frac{S^2_B}{n_B}}} \sim St(n_A + n_B - 2)$
-   Si $n_A \neq n_B$: $t_{obs} = \frac{(\bar{Y_A} - \bar{Y_B}) - (\mu_A - \mu_B)}{\sqrt{(\frac{(n_A - 1) \times S^2_A + (n_B - 1) \times S^2_B}{n_A + n_B - 2})(\frac{1}{n_A} + \frac{1}{n_B})}} \sim St(n_A + n_B - 2)$.

Notre étude se situant dans le premier cas, on a alors:

$t_{obs} = \frac{(34,67 - 40,87) - (0)}{\sqrt{\frac{24,67}{15} + \frac{28,69}{15}}} = -3,287$.

Avec le dégré de liberté $df = n_A + n_B - 2 = 15 + 15 - 2 = 28$, on a :

```{r}
qt(p=0.05/2, df=28, lower.tail=FALSE)
```

La valeur critique de $t_{28}$ pour une valeur de 0,05 est de 2,048, de sorte que les deux moyennes de l'échantillon ont une probabilité inférieure à 5 % d'être issues de la même population.

### Test de $t$ pairé *vs* test de $t$ indépendant

Et si on avait analysé l\'exemple des sprinteurs comme si les observations des 2 jours étaient indépendantes? A ce moment on obtiendrait $t_{obs} = -0.084$, $df = 18$, $t_{lu} = -2,1$.

La différence entre les 2 jours n\'apparaît plus du tout comme significative!!

Pourquoi?

Dans un test de t indépendant, on intègre la différence entre sprinteurs dans la variation due au hasard. De ce fait, la **différence entre moyennes** des 2 jours paraît faible comparée aux différences entre sprinteurs.
